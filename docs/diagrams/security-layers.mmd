%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#EF4444'}}}%%

flowchart TB
    subgraph External["ğŸŒ Couche Externe"]
        Internet["Internet"]
        Attacker["âš ï¸ Attaquants"]
    end

    subgraph Edge["ğŸ›¡ï¸ Edge Security"]
        CDN["CDN<br/>(CloudFlare)"]
        WAF["WAF<br/>(Web Application Firewall)"]
        DDoS["DDoS Protection"]
    end

    subgraph Network["ğŸ”’ Network Security"]
        LB["Load Balancer<br/>(TLS 1.3)"]
        VPC["VPC / Private Network"]
        Firewall["Firewall Rules"]
    end

    subgraph Application["ğŸ” Application Security"]
        Gateway["API Gateway"]
        
        subgraph AuthLayer["Authentication"]
            JWT["JWT Validation"]
            OAuth["OAuth 2.0"]
            MFA["MFA / OTP"]
        end
        
        subgraph AuthzLayer["Authorization"]
            RBAC["RBAC<br/>(Role-Based Access)"]
            Permissions["Fine-grained Permissions"]
            KYCLevel["KYC Level Check"]
        end
        
        subgraph Validation["Input Validation"]
            Sanitize["Input Sanitization"]
            RateLimit["Rate Limiting"]
            Validation2["Schema Validation"]
        end
    end

    subgraph Data["ğŸ’¾ Data Security"]
        Encryption["Encryption at Rest<br/>(AES-256)"]
        TLS["Encryption in Transit<br/>(TLS 1.3)"]
        Masking["Data Masking"]
        Hashing["Password Hashing<br/>(Bcrypt)"]
    end

    subgraph Secrets["ğŸ”‘ Secrets Management"]
        Vault["HashiCorp Vault /<br/>AWS KMS"]
        Rotation["Key Rotation<br/>(90 days)"]
    end

    subgraph Audit["ğŸ“ Audit & Compliance"]
        Logging["Audit Logging"]
        SIEM["SIEM Integration"]
        Compliance["LCB-FT Monitoring"]
    end

    Internet --> CDN
    Attacker --> CDN
    CDN --> WAF
    WAF --> DDoS
    DDoS --> LB
    LB --> VPC
    VPC --> Firewall
    Firewall --> Gateway
    Gateway --> AuthLayer
    AuthLayer --> AuthzLayer
    AuthzLayer --> Validation
    Validation --> Data
    Data --> Secrets
    Gateway --> Audit

    subgraph Legend["ğŸ“‹ Niveaux de SÃ©curitÃ© par Action"]
        L1["ğŸŸ¢ Niveau 1<br/>Lecture seule<br/>JWT uniquement"]
        L2["ğŸŸ¡ Niveau 2<br/>Transactions < 50K<br/>JWT + PIN"]
        L3["ğŸŸ  Niveau 3<br/>Transactions < 500K<br/>JWT + PIN + KYC L2"]
        L4["ğŸ”´ Niveau 4<br/>Transactions > 500K<br/>JWT + PIN + OTP + KYC L3"]
    end
